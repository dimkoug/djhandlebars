function getCookie(t){var e=null;if(document.cookie&&""!==document.cookie)for(var a=document.cookie.split(";"),o=0;o<a.length;o++){var n=jQuery.trim(a[o]);if(n.substring(0,t.length+1)===t+"="){e=decodeURIComponent(n.substring(t.length+1));break}}return e}var csrftoken=getCookie("csrftoken");function csrfSafeMethod(t){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(t)}$.ajaxSetup({beforeSend:function(t,e){csrfSafeMethod(e.type)||this.crossDomain||t.setRequestHeader("X-CSRFToken",csrftoken)}});let data=null;const BASE_URL="/api/",get_data=async function(t){await $.when($.ajax({url:t,method:"get",datatype:"json",headers:{Authorization:"JWT "+localStorage.token}})).then(function(t,e,a){data=t}).catch(function(t){$.each(t.responseJSON,function(t,e){console.info(t,e),$("#id_"+t).addClass("is-invalid"),$("#id_"+t).after("<div class='invalid-feedback'>"+e+"</div>")})})};async function generate_template(t,e,a,o){let n=null,i=null;localStorage.token?i=(n=templates[t+"_"+e])({data:a,model:t,url:o}):(t="user",i=(n="register"===e?templates[t+"_"+e]:templates[t+"_login"])({model:t})),$("#content").html(i).show("slow"),"user"!==t&&await populate_selectbox()}function logged_in(){localStorage.token?($(".logout").show(),$(".login").hide(),$(".login_url").hide(),$(".register").hide()):($(".logout").hide(),$(".login").show(),$(".register").show(),$(".login_url").show())}$(document).ajaxStart(function(){$(".spinner-border").show()}).ajaxStop(function(){$(".spinner-border").hide()});const templates={user_login:app.templates.user_login,user_register:app.templates.user_register,tag_list:app.templates.tag_list,tag_form:app.templates.tag_form,category_list:app.templates.category_list,category_form:app.templates.category_form,todo_list:app.templates.todo_list,todo_form:app.templates.todo_form};async function populate_selectbox(){$("select").each(async function(){let t=null,e=$(this).data("url"),a=$(this).data("selected");console.info(typeof a),a="string"==typeof a?a.split(","):[a],console.info(a),await $.ajax({url:e,method:"get",datatype:"json",headers:{Authorization:"JWT "+localStorage.token}}).then(function(e,a,o){t=e.results}).catch(function(t){$.each(t.responseJSON,function(t,e){console.info(t,e),$("#id_"+t).addClass("is-invalid"),$("#id_"+t).after("<div class='invalid-feedback'>"+e+"</div>")})}),$(this).html("");let o="<option value>---------</option>";if(t&&0!==t.length)for(var n=0;n<t.length;n++){let e="";for(let o=0;o<a.length;o++)parseInt(a[o])===parseInt(t[n].id)&&(e="selected");o+=`<option value="${parseInt(t[n].id)}" ${e}>${t[n].text}</option>`}else o="<option value>---------</option>";$(this).html(o),$(this).select2()})}!function(t,e,a){a(e).ready(function(){logged_in(),a(".spinner-border").hide(),a("body").on("click","#logout",function(t){t.preventDefault(),localStorage.clear(),window.location="/",console.info("log out"),logged_in()})})}(window,document,jQuery),function(t,e,a){a(e).ready(function(){a("body").on("click",".create-link",async function(t){t.preventDefault();let e=a(this).attr("href"),o=(a(this).attr("class"),a(this).data("model")),n=a(this).data("action"),i={url:e,model:o,method:a(this).data("method"),collection:e};return await generate_template(o,n,i,e),!1})})}(window,document,jQuery),function(t,e,a){a(e).ready(function(){a("body").on("submit","#form",async function(e){let o=a(this).attr("action"),n=!1;a("body").removeClass("is-invalid"),a("body").find(".invalid-feedback").remove();a(this).attr("class");let i=a(this).data("model"),l=a(this).attr("method"),s=a(this).data("collection");return e.preventDefault(),console.info(localStorage.token),null!==localStorage.token&&"user"!==i&&(console.info(i),await a.when(a.ajax({url:o,data:a(this).serialize(),type:l,headers:{Authorization:"JWT "+localStorage.token},statusCode:{400:function(){n=!0}}})).then(function(t,e,a){console.info(t)}).catch(function(t){n=!0,a.each(t.responseJSON,function(t,e){console.info(t,e),a("#id_"+t).addClass("is-invalid"),a("#id_"+t).after("<div class='invalid-feedback'>"+e+"</div>")})})),"user"===i&&await a.when(a.ajax({url:o,data:a(this).serialize(),type:l})).then(function(t,e,a){console.info(t),t.access&&(localStorage.token=t.access,logged_in())}).catch(function(t){n=!0,a.each(t.responseJSON,function(t,e){console.info(t,e),a("#id_"+t).addClass("is-invalid"),a("#id_"+t).after("<div class='invalid-feedback'>"+e+"</div>")})}),"user"!==i?(s?await get_data(s):await get_data(o),n||(console.info("error"),await generate_template(i,"list",data,o))):n||(console.info("error"),t.location="/"),await!1})})}(window,document,jQuery),function(t,e,a){a(e).ready(function(){a("body").on("click",".api-link",async function(t){let e=a(this).attr("href"),o=a(this).data("model"),n=a(this).data("action"),i=(a(this).data("method"),e.split("?")[0]);return a(this).data("url")&&(e=a(this).data("url")),t.preventDefault(),console.info(e),await get_data(e),console.info(data),await generate_template(o,n,data,i),!1})})}(window,document,jQuery),function(t,e,a){a(e).ready(function(){a("body").on("click",".update, .delete",async function(t){t.preventDefault();let e=a(this).attr("href"),o=a(this).attr("class"),n=a(this).data("model"),i=(a(this).data("action"),a(this).data("method")),l=a(this).data("collection");console.info(l);let s={url:e,model:n,method:i,collection:l};return"update"===o&&(await a.when(a.ajax({url:e,method:"get",datatype:"json",headers:{Authorization:"JWT "+localStorage.token}})).then(function(t,e,a){s.obj=t;let o=[];if("tags"in t){for(let e=0;e<t.tags.length;e++)o.push(t.tags[e].id);s.tags=o}}).catch(function(t){a.each(t.responseJSON,function(t,e){console.info(t,e),a("#id_"+t).addClass("is-invalid"),a("#id_"+t).after("<div class='invalid-feedback'>"+e+"</div>")})}),s.method="put",console.info(s),await generate_template(n,"form",s,e)),"delete"===o&&confirm(a(this).data("confirm"))&&(await a.when(a.ajax({url:e,method:"delete",datatype:"json"})).catch(function(t){a.each(t.responseJSON,function(t,e){console.info(t,e),a("#id_"+t).addClass("is-invalid"),a("#id_"+t).after("<div class='invalid-feedback'>"+e+"</div>")})}),l&&await get_data(l),await generate_template(n,"list",data,l)),!1})})}(window,document,jQuery);