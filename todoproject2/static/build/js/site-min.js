!function(t,e,a){"use strict";a(document).ready(function(){var t="/todo/api/",e={categories:[],todos:[],tags:[]};a("#logout").click(function(){localStorage.clear(),window.location="/"});var o={user_login:app.templates.user_login,user_register:app.templates.user_register,tags_list:app.templates.tags_list,tags_create_form:app.templates.tags_create_form,tags_put:app.templates.tags_put,categories_list:app.templates.categories_list,categories_create_form:app.templates.categories_create_form,categories_put:app.templates.categories_put,todos_list:app.templates.todos_list,todos_create_form:app.templates.todos_create_form,todos_put:app.templates.todos_put};function n(t){if(null!=t.next){var e=t.next.split("/")[5];a(".paginator").append(`<div class='col-2'>\n            <a href="${t.next}" data-model="${e}" data-action="list" class="page next">next</a>\n            </div>`)}else a(".next").hide();if(null!=t.previous){e=t.previous.split("/")[5];a(".paginator").append(`<div class='col-2'>\n            <a href="${t.previous}" data-model="${e}" data-action="list" class="page prev">previous</a>\n            </div>`)}else a(".prev").hide()}function r(t,e,o){if(t.html(""),a.isArray(o))var n=e({data:o});else n=e(o);t.html(n).show("slow")}function i(t,o){if(localStorage.token)return a.when(a.ajax({url:t,method:"GET",datatype:"json",headers:{Authorization:"JWT "+localStorage.token}})).then(function(t,a,n){var r=t.results;e[o]=r})}function s(t,i){localStorage.token?(a("#content").html(""),a.when(a.ajax({url:t,method:"GET",datatype:"json",headers:{Authorization:"JWT "+localStorage.token}})).then(function(t,s,l){var c=t.results;e[i]=c;var d=o[i+"_list"];r(a("#content"),d,e[i]),n(t)})):a("#content").html("Login")}function l(){localStorage.token?(a(".logout").show(),a("#login").hide(),a(".login_url").hide(),a(".register").hide()):(a(".logout").hide(),a("#login").show(),a(".register").show(),a(".login_url").show())}Handlebars.registerHelper("makeSelectBox",function(t,e,a){var o=a,n='<label for="'+t+'" class="form-label">'+t+'</label><select class="form-control" name="'+t+'">';for(var r in o){var i=parseInt(o[r].id);""!=e&&parseInt(e)==i?n+='<option value="'+i+'" selected>'+o[r].name+"</option>":n+='<option value="'+i+'">'+o[r].name+"</option>"}return n+="</select>"}),Handlebars.registerHelper("makeSelectBoxMultiple",function(t,e,a){var o=a,n='<label for="'+t+'" class="form-label">'+t+'</label><select class="form-control" name="'+t+'" multiple="multiple">';for(var r in o){var i=parseInt(o[r].id),s=!1;for(var l in e)parseInt(e[l].id)==i&&(s=!0);n+=1==s?'<option value="'+i+'" selected>'+o[r].name+"</option>":'<option value="'+i+'">'+o[r].name+"</option>"}return n+="</select>"}),a("body").on("click","#categories, #todos, #tags",function(e){return e.preventDefault(),s(t+a(this).data("url"),a(this).data("model")),!1}),a("body").on("click","#register, .create, #login_url",function(t){t.preventDefault();var n=a(this).data("model"),s=a(this).data("action");if("todos"==n){a.when(i("/todo/api/categories/?page_size=100","categories")).then(function(t,l,c){a.when(i("/todo/api/tags/?page_size=100","tags")).then(function(t,i,l){t={categories:e.categories,tags:e.tags};var c=o[n+"_"+s];r(a("#content"),c,t)})})}else{var l=o[n+"_"+s];r(a("#content"),l,{})}return!1}),a("body").on("click",".page",function(t){t.preventDefault();var e=a(this).data("model");a("#content").html("");localStorage.token;return a.when(a.ajax({url:a(this).attr("href"),method:"get",datatype:"json",headers:{Authorization:"JWT "+localStorage.token}})).then(function(t,i,s){var l=t.results,c=o[e+"_list"];r(a("#content"),c,l),n(t)}),!1}),a("body").on("click",".delete",function(e){e.preventDefault();localStorage.token;a(this).fadeOut();var o=a(this).data("id"),n=a(this).data("action");return function(t,e,o,n){a.when(a.ajax({url:t,method:e,datatype:"json",headers:{Authorization:"JWT "+localStorage.token}})).then(function(t,e,a){s(o,n)})}(t+a(this).data("url")+o,n,t+a(this).data("url"),a(this).data("model")),!1}),a("body").on("click",".update",function(n){n.preventDefault();var s=a(this).data("id"),l=a(this).data("model"),c=a(this).data("action"),d=a(this).data("url");return a.when(a.ajax({url:t+d+s,method:"get",datatype:"json",headers:{Authorization:"JWT "+localStorage.token}})).then(function(n,s,u){var p=n,h=t+d+p.id+"/",g={url:h,item:p};if("todos"==l){a.when(i("/todo/api/categories/?page_size=100","categories")).then(function(t,n,s){a.when(i("/todo/api/tags/?page_size=100","tags")).then(function(t,n,i){t={url:h,item:p,categories:e.categories,tags:e.tags};var s=o[l+"_"+c];r(a("#content"),s,t)})})}else{var f=o[l+"_"+c];r(a("#content"),f,g)}}),!1}),l(),a("body").on("submit","#login",function(t){t.preventDefault();var e=a(this).serialize();return a.ajax({url:a(this).attr("action"),method:a(this).attr("method"),data:e,headers:{"X-CSRFToken":csrftoken},datatype:"json",success:function(t){if("undefined"!=t.token){localStorage.token=t.token,l();s("/todo/api/todos/","todos")}}}),!1});s("/todo/api/todos/","todos"),a("body").on("submit","#form",function(e){e.preventDefault();a(this).data("model_url");var o=a(this).data("model"),n=a(this).serialize(),r=localStorage.token;headers={"X-CSRFToken":csrftoken,Authorization:"JWT "+r},a.when(a.ajax({url:a(this).attr("action"),method:a(this).attr("method"),data:n,headers:headers,datatype:"json"})).then(function(e,n,r){a("#form")[0].reset();var i=t+i;s(i,o)}).catch(function(t){alert(JSON.stringify(t.responseText))})})})}(window,document,jQuery);